module.exports=[38324,a=>{"use strict";var b=a.i(41063),c=a.i(44995),d=a.i(72273);let e=async()=>(0,c.createClient)("https://jyjynjpznlvezjhnuwhi.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1,autoRefreshToken:!1}});(0,d.ensureServerEntryExports)([e]),(0,b.registerServerReference)(e,"007f4304d26a5fb9f73eb78d5882ca3b3d3f30d5f2",null),a.s(["createAdminClient",0,e])},74377,a=>{"use strict";var b=a.i(41063),c=a.i(29024),d=a.i(69168);async function e({recipientId:a,actorId:b,actorUsername:d,type:e,targetPostId:f}){if(a===b)return;let g=await (0,c.createClient)(),h={recipient_id:a,actor_id:b,actor_username:d,type:e,is_read:!1};f&&(h.target_post_id=f);let{error:i}=await g.from("notifications").insert(h);i&&console.error("Failed to create notification:",i)}async function f(a){let b=await (0,c.createClient)();await b.from("notifications").update({is_read:!0}).eq("id",a),(0,d.revalidatePath)("/profile/notifications")}async function g(a){let b=await (0,c.createClient)();await b.from("notifications").delete().eq("id",a),(0,d.revalidatePath)("/profile/notifications")}async function h(a){let b=await (0,c.createClient)();await b.from("notifications").update({is_read:!0}).eq("recipient_id",a),(0,d.revalidatePath)("/profile/notifications")}async function i({actorId:a,type:b,recipientId:d,targetPostId:e}){let f=(await (0,c.createClient)()).from("notifications").delete({count:"exact"}).eq("actor_id",a).eq("type",b);d&&(f=f.eq("recipient_id",d)),f=e?f.eq("target_post_id",e):f.is("target_post_id",null);let{error:g}=await f;g&&console.error("âŒ Failed to delete notification:",g.message)}(0,a.i(72273).ensureServerEntryExports)([e,f,g,h,i]),(0,b.registerServerReference)(e,"4055d54f0d2ce76fe4785b7a81a03bfc7992dd262e",null),(0,b.registerServerReference)(f,"40b2724402b497cfd26d5086c2042bf019bb6870be",null),(0,b.registerServerReference)(g,"40bc84fad6ba83d0ba85bf176415a72eeef431e50e",null),(0,b.registerServerReference)(h,"40c0cbdc7402307eb18de4ec6234fefc650ff8bbf8",null),(0,b.registerServerReference)(i,"409b80e89bed5cbab2bcde39cf4ed6945329720442",null),a.s(["createNotification",()=>e,"deleteNotification",()=>i,"dismissNotification",()=>g,"markAllNotificationsAsRead",()=>h,"markNotificationAsRead",()=>f])},15326,a=>{"use strict";var b=a.i(41063),c=a.i(29024),d=a.i(69168);async function e(){(0,d.unstable_noStore)();let a=await (0,c.createClient)(),{data:b,error:e}=await a.from("posts").select(`
            *,
            author:profiles!posts_author_id_fkey(*), 
            movie:movies(title, poster_url),
            series:series(title, poster_url)
        `).is("deleted_at",null).order("created_at",{ascending:!1}).limit(20);return e?(console.error("Error fetching posts:",e),[]):b}async function f(a){(0,d.unstable_noStore)();let b=await (0,c.createClient)(),{data:{user:e}}=await b.auth.getUser(),{data:f,error:g}=await b.from("posts").select(`
            *,
            author:profiles!posts_author_id_fkey(*),
            movie:movies(*),
            series:series(*),
            comments(*, author:profiles!comments_author_id_fkey(username, display_name, profile_pic_url))
        `).eq("slug",a).is("deleted_at",null).maybeSingle();if(g)return console.error("Error fetching post by slug:",g),null;if(!f)return null;f.comments&&f.comments.sort((a,b)=>new Date(b.created_at).getTime()-new Date(a.created_at).getTime());let h=!1;if(e){let{data:a}=await b.from("likes").select("user_id").match({post_id:f.id,user_id:e.id}).maybeSingle();h=!!a}let i=f.likes_count||0;return{...f,likeCount:i,userHasLiked:h}}async function g(a){(0,d.unstable_noStore)();let b=await (0,c.createClient)(),{data:e,error:f}=await b.from("posts").select(`
            *,
            author:profiles!posts_author_id_fkey(*),
            movie:movies(title, poster_url),
            series:series(title, poster_url)
        `).eq("author_id",a).is("deleted_at",null).order("created_at",{ascending:!1});return f?(console.error("Error fetching user's posts:",f),[]):e}(0,a.i(72273).ensureServerEntryExports)([e,f,g]),(0,b.registerServerReference)(e,"008e1f566358a07c56cbcf6a37e0c58a5f5bbfa8a1",null),(0,b.registerServerReference)(f,"404ff85bb640c099da1a9f675bc663db9fe4c5b2cb",null),(0,b.registerServerReference)(g,"401a9682bcfbb237d001ac1e3b3847b37b21a35527",null),a.s(["getPostBySlug",()=>f,"getPosts",()=>e,"getPostsByUserId",()=>g])},66680,(a,b,c)=>{b.exports=a.x("node:crypto",()=>require("node:crypto"))},52254,a=>{"use strict";var b=a.i(41063),c=a.i(59263),d=a.i(29024);a.i(16162);var e=a.i(25161),f=a.i(69168),g=a.i(76181),h=a.i(66680);let i={randomUUID:h.randomUUID},j=new Uint8Array(256),k=j.length,l=[];for(let a=0;a<256;++a)l.push((a+256).toString(16).slice(1));let m=function(a,b,c){if(i.randomUUID&&!b&&!a)return i.randomUUID();var d=a,e=c;let f=(d=d||{}).random??d.rng?.()??(k>j.length-16&&((0,h.randomFillSync)(j),k=0),j.slice(k,k+=16));if(f.length<16)throw Error("Random bytes length must be >= 16");if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b){if((e=e||0)<0||e+16>b.length)throw RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let a=0;a<16;++a)b[e+a]=f[a];return b}return function(a,b=0){return(l[a[b+0]]+l[a[b+1]]+l[a[b+2]]+l[a[b+3]]+"-"+l[a[b+4]]+l[a[b+5]]+"-"+l[a[b+6]]+l[a[b+7]]+"-"+l[a[b+8]]+l[a[b+9]]+"-"+l[a[b+10]]+l[a[b+11]]+l[a[b+12]]+l[a[b+13]]+l[a[b+14]]+l[a[b+15]]).toLowerCase()}(f)};var n=a.i(76216),o=a.i(74377),p=a.i(15326),q=a.i(72273);let r=c.z.object({image:c.z.instanceof(File,{message:"A file is required."}).refine(a=>a.size>0,"File cannot be empty.").refine(a=>a.type.startsWith("image/"),"File must be an image.").refine(a=>a.size<5242880,"Image must be less than 5MB.")});async function s(a){let b=await (0,d.createClient)(),c=await (0,g.getUserProfile)();if(!c?.user)return{success:!1,error:"You must be logged in to upload images."};let e=r.safeParse({image:a.get("image")});if(!e.success){let a=e.error.flatten().fieldErrors;return{success:!1,error:a.image?.[0]||"Invalid file."}}let{image:f}=e.data,h=f.name.split(".").pop(),i=`${m()}.${h}`,j=`${c.user.id}/content_images/${i}`,{error:k}=await b.storage.from("post_images").upload(j,f);if(k)return console.error("Content Image Upload Error:",k),{success:!1,error:"Could not upload the image."};let{data:l}=b.storage.from("post_images").getPublicUrl(j);return{success:!0,url:l.publicUrl}}let t=c.z.object({banner:c.z.instanceof(File,{message:"A file is required."}).refine(a=>a.size>0,"File cannot be empty.").refine(a=>a.type.startsWith("image/"),"File must be an image.").refine(a=>a.size<4194304,"Image must be less than 4MB.")});async function u(a){let b=await (0,d.createClient)(),c=await (0,g.getUserProfile)();if(!c?.user)return{success:!1,error:"You must be logged in to upload images."};let e=t.safeParse({banner:a.get("banner")});if(!e.success){let a=e.error.flatten().fieldErrors;return{success:!1,error:a.banner?.[0]||"Invalid file."}}let{banner:f}=e.data,h=f.name.split(".").pop(),i=`${m()}.${h}`,j=`${c.user.id}/${i}`,{error:k}=await b.storage.from("post_banners").upload(j,f);if(k)return console.error("Banner Upload Error:",k),{success:!1,error:"Could not upload banner image."};let{data:l}=b.storage.from("post_banners").getPublicUrl(j);return{success:!0,url:l.publicUrl}}let v=c.z.object({title:c.z.string().min(3,{message:"Title must be at least 3 characters."}),content_html:c.z.string().min(50,{message:"Content must be at least 50 characters."}),cinematicApiId:c.z.coerce.number().optional(),media_type:c.z.enum(["movie","tv"]).optional(),banner_url:c.z.string().url({message:"Invalid banner URL."}).optional().or(c.z.literal("")),rating:c.z.coerce.number().min(0).max(5).step(.5).optional(),is_premium:c.z.string().optional().transform(a=>"on"===a),is_nsfw:c.z.string().optional().transform(a=>"on"===a),has_spoilers:c.z.string().optional().transform(a=>"on"===a)});async function w(a,b){let c,h,i,j=await (0,d.createClient)(),k=await (0,g.getUserProfile)();if(!k?.user||!k.profile)return{message:"You must be logged in."};let l=v.safeParse(Object.fromEntries(b.entries()));if(!l.success)return{errors:l.error.flatten().fieldErrors};let{title:m,content_html:o,banner_url:p,cinematicApiId:q,media_type:r,rating:s,is_premium:t,is_nsfw:u,has_spoilers:w}=l.data,x=(c=(Math.random()+1).toString(36).substring(7),m.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")+`-${c}`);if(q&&r)try{"movie"===r?(await (0,n.getMovieDetails)(q),h=q):"tv"===r&&(await (0,n.getSeriesDetails)(q),i=q)}catch(a){return{message:"Server Error: Could not fetch details for the linked item."}}else if(q&&!r)return{errors:{cinematic:["Media type is missing."]}};let y={author_id:k.user.id,title:m,content_html:o,slug:x,banner_url:p||null,type:q?"review":"general",movie_id:h,series_id:i,rating:s,is_premium:t,is_nsfw:u,has_spoilers:w},{error:z}=await j.from("posts").insert(y);if(z)return console.error("Post insert error:",z),{message:"Database Error: Could not create post."};(0,f.revalidatePath)("/blog"),(0,e.redirect)(`/blog/${x}`)}async function x(a){let b=await (0,d.createClient)(),c=await (0,g.getUserProfile)();if(!c?.user||!c.profile)return{error:"You must be logged in."};let{error:e}=await b.from("likes").insert({post_id:a,user_id:c.user.id});if(e)return console.error("Like error:",e),{error:"Error liking post."};let{data:h}=await b.from("posts").select("author_id").eq("id",a).single();return h&&h.author_id!==c.user.id&&await (0,o.createNotification)({recipientId:h.author_id,actorId:c.user.id,actorUsername:c.profile.username,type:"like",targetPostId:a}),(0,f.revalidatePath)("/blog/[slug]","page"),{success:!0}}async function y(a){let b=await (0,d.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return{error:"You must be logged in to unlike a post."};let{error:e}=await b.from("likes").delete().match({post_id:a,user_id:c.id});return e?(console.error("Unlike error:",e),{error:"There was an error unliking the post."}):(await (0,o.deleteNotification)({actorId:c.id,type:"like",targetPostId:a}),(0,f.revalidatePath)("/blog/[slug]","page"),{success:!0})}async function z(a,b){let c=await (0,d.createClient)(),e=await (0,g.getUserProfile)();if(!e?.user||!e.profile)return{error:"You must be logged in to comment."};let h=b.get("comment");if(!h||h.trim().length<3)return{error:"Comment must be at least 3 characters."};let{error:i}=await c.from("comments").insert({post_id:a,author_id:e.user.id,content:h.trim()});if(i)return console.error("Comment insert error:",i),{error:"Could not post comment. Please try again."};let{data:j}=await c.from("posts").select("author_id").eq("id",a).single();return j&&j.author_id!==e.user.id&&await (0,o.createNotification)({recipientId:j.author_id,actorId:e.user.id,actorUsername:e.profile.username,type:"comment",targetPostId:a}),(0,f.revalidatePath)("/blog/[slug]","page"),{success:"Comment posted!"}}let A=c.z.object({postId:c.z.string().uuid(),title:c.z.string().min(3),content_html:c.z.string().min(50),cinematicApiId:c.z.coerce.number().optional(),media_type:c.z.enum(["movie","tv"]).optional(),banner_url:c.z.string().optional().or(c.z.literal("")),rating:c.z.coerce.number().min(0).max(5).step(.5).optional(),is_premium:c.z.string().optional().transform(a=>"on"===a),is_nsfw:c.z.string().optional().transform(a=>"on"===a),has_spoilers:c.z.string().optional().transform(a=>"on"===a)});async function B(a,b){let c=await (0,d.createClient)(),h=await (0,g.getUserProfile)();if(!h?.user)return{message:"You must be logged in."};let i=b.get("postId"),{data:j}=await c.from("posts").select("author_id, slug").eq("id",i).single();if(!j||j.author_id!==h.user.id)return{message:"Unauthorized: You do not own this post."};let k=A.safeParse(Object.fromEntries(b.entries()));if(!k.success)return{errors:k.error.flatten().fieldErrors};let{title:l,content_html:m,banner_url:o,cinematicApiId:p,media_type:q,rating:r,is_premium:s,is_nsfw:t,has_spoilers:u}=k.data,v=null,w=null;if(p&&q)try{"movie"===q?(await (0,n.getMovieDetails)(p),v=p):"tv"===q&&(await (0,n.getSeriesDetails)(p),w=p)}catch(a){return{message:"Server Error: Could not fetch details for the linked item."}}let{error:x}=await c.from("posts").update({title:l,content_html:m,banner_url:o||null,type:p?"review":"general",movie_id:v,series_id:w,rating:r,is_premium:s,is_nsfw:t,has_spoilers:u}).eq("id",i);if(x)return console.error("Update error:",x),{message:"Database Error: Could not update post."};(0,f.revalidatePath)(`/blog/${j.slug}`),(0,f.revalidatePath)("/blog"),(0,e.redirect)(`/blog/${j.slug}`)}async function C(a){let b=await (0,d.createClient)(),c=await (0,g.getUserProfile)();if(!c?.user||!c.profile)return{success:!1,error:"Unauthorized"};let{data:e}=await b.from("posts").select("author_id").eq("id",a).single();if(!e||e.author_id!==c.user.id)return{success:!1,error:"You can only delete your own posts."};let{error:h}=await b.from("posts").update({deleted_at:new Date().toISOString()}).eq("id",a);return h?(console.error("Delete error",h),{success:!1,error:"Failed to delete post"}):((0,f.revalidatePath)("/blog"),(0,f.revalidatePath)(`/profile/${c.profile.username}/posts`),{success:!0})}async function D(a){let b=await (0,g.getProfileByUsername)(a);return b?await (0,p.getPostsByUserId)(b.id):[]}(0,q.ensureServerEntryExports)([s,u,w,x,y,z,B,C,D]),(0,b.registerServerReference)(s,"40b39c1c50ea916b79e29c4b58f5aaa0c7646b942f",null),(0,b.registerServerReference)(u,"40caf8e6eb284073880d186f232af97efac0fe1041",null),(0,b.registerServerReference)(w,"602e668d082821296879bcd81f75884bdcc96b1659",null),(0,b.registerServerReference)(x,"4078da1d4fb9a5542ae1d51973e0b8a06cc0aeab4f",null),(0,b.registerServerReference)(y,"40e5446b1292d63454d14ed79d9d274ea883ca0188",null),(0,b.registerServerReference)(z,"6071c570ebbe999a62b617f1e0741c053c497daeeb",null),(0,b.registerServerReference)(B,"609ee5f20023be9a1cc338f7e049fb83021701fcc7",null),(0,b.registerServerReference)(C,"404027ac4c5756e9197c0c675f5cf62efd8da1160e",null),(0,b.registerServerReference)(D,"4056968e7ebdb6a929115a5339dde405b855039799",null),a.s(["createPost",()=>w,"deletePost",()=>C,"likePost",()=>x,"postComment",()=>z,"unlikePost",()=>y,"updatePost",()=>B,"uploadBanner",()=>u,"uploadContentImage",()=>s],52254)},84708,a=>{"use strict";var b=a.i(76181),c=a.i(58139),d=a.i(52254);a.s([],84983),a.i(84983),a.s(["00683e089f24bf051dde09a3a6d87c7845379672d7",()=>b.getProfileForEdit,"00a5e44efe8453720c80c4486c1d17d72add854a24",()=>c.logout,"00d0567cd8df0fc447dd1e815c2ddf184f0c18128e",()=>b.getUserProfile,"400bcb2c36f7c47e3731ae06dffd2224b3a2699e1e",()=>b.getFollowRequests,"4014fbfdff9342dd0c42b9ff583a3342422dc0f22a",()=>b.getProfileByUsername,"401f2c77db66442cf38ce5a83c458e601f1c7b05c7",()=>b.getProfileAndFollowStatus,"402c60c195c27d7e4ee6875efa618185b1ac3231fb",()=>b.getFollowers,"4047dd0ce88f4279733a1b257efef3eef9f46b98fe",()=>b.checkProfileCompletion,"40b39c1c50ea916b79e29c4b58f5aaa0c7646b942f",()=>d.uploadContentImage,"40bf4c0ef6c82b5f8fcdc9b4949d7d08040b4dd7de",()=>b.getFollowing,"40caf8e6eb284073880d186f232af97efac0fe1041",()=>d.uploadBanner,"40cfbf6bd851b4c3c77831a2af2103b1bc31d65c9f",()=>b.getProfileData,"40cfe719a5adbe13aa2b30a3a28352a6402447f1e9",()=>b.getPodiumData,"609ee5f20023be9a1cc338f7e049fb83021701fcc7",()=>d.updatePost,"60c2b24991e2dd0ce0aa7dddb015e6a9b621b2c5e6",()=>b.checkFollowStatus],84708)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__162d2326._.js.map