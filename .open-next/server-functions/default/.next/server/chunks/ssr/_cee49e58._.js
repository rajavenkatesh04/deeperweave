module.exports=[38324,a=>{"use strict";var b=a.i(41063),c=a.i(44995),d=a.i(72273);let e=async()=>(0,c.createClient)("https://jyjynjpznlvezjhnuwhi.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1,autoRefreshToken:!1}});(0,d.ensureServerEntryExports)([e]),(0,b.registerServerReference)(e,"007f4304d26a5fb9f73eb78d5882ca3b3d3f30d5f2",null),a.s(["createAdminClient",0,e])},90093,a=>{"use strict";var b=a.i(41063),c=a.i(38324),d=a.i(69168),e=a.i(29024);async function f(b){(0,d.unstable_noStore)();let{createClient:c}=await a.A(56941),e=await c(),{data:f,error:g}=await e.from("timeline_entries").select(`
            *,
            movies (*),
            series (*),
            posts (slug),
            timeline_collaborators (*, profiles (id, username, profile_pic_url))
        `).eq("user_id",b).order("watched_on",{ascending:!0}).order("created_at",{ascending:!0});if(g)return console.error("Error fetching timeline entries:",g),[];let h={};return f.map(a=>{let b=Array.isArray(a.movies)?a.movies[0]:a.movies,c=Array.isArray(a.series)?a.series[0]:a.series,d=b?`movie_${b.tmdb_id}`:c?`tv_${c.tmdb_id}`:null,e=0;d&&(h[d]=(h[d]||0)+1,e=h[d]);let f=e>0?e-1:0;return{...a,movies:b,series:c,posts:Array.isArray(a.posts)?a.posts[0]:a.posts,timeline_collaborators:(a.timeline_collaborators||[]).map(a=>({...a,profiles:Array.isArray(a.profiles)?a.profiles[0]:a.profiles})),is_rewatch:f>0,rewatch_count:f}}).reverse()}async function g(a){(0,d.unstable_noStore)();let b=await (0,c.createAdminClient)(),{data:e,error:f}=await b.from("timeline_entries").select(`
            *,
            movies (*),
            series (*),
            posts (slug),
            profiles:user_id (username, display_name, profile_pic_url),
            timeline_collaborators (*, profiles (id, username, profile_pic_url))
        `).eq("id",a).single();if(f||!e)return console.error(`Supabase error fetching timeline entry ${a} (as admin):`,f),null;let g={...e,movies:Array.isArray(e.movies)?e.movies[0]:e.movies,series:Array.isArray(e.series)?e.series[0]:e.series,posts:Array.isArray(e.posts)?e.posts[0]:e.posts,profiles:Array.isArray(e.profiles)?e.profiles[0]:e.profiles,timeline_collaborators:(e.timeline_collaborators||[]).map(a=>({...a,profiles:Array.isArray(a.profiles)?a.profiles[0]:a.profiles}))};return g.movies||g.series?g.profiles?g:(console.error(`Error: Timeline entry ${a} has no associated profile.`),null):(console.error(`Error: Timeline entry ${a} has no associated movie or series data.`),null)}async function h(a,b,c){(0,d.unstable_noStore)();let f=await (0,e.createClient)(),g="movie"===b?"movie_id":"series_id",{data:h}=await f.from("timeline_entries").select("*").eq("user_id",a).eq(g,c).order("watched_on",{ascending:!1}),{data:i}=await f.from("followers").select("following_id").eq("follower_id",a).eq("status","accepted"),j=i?.map(a=>a.following_id)||[],k=[];if(j.length>0){let{data:a}=await f.from("timeline_entries").select(`
                *,
                profiles:user_id (username, display_name, profile_pic_url)
            `).in("user_id",j).eq(g,c).order("watched_on",{ascending:!1});a&&(k=a)}return{myEntries:h||[],friendEntries:k||[],watchCount:h?.length||0}}(0,a.i(72273).ensureServerEntryExports)([f,g,h]),(0,b.registerServerReference)(f,"405a83a00c08994b5b17f545dc1643993ea0e7347c",null),(0,b.registerServerReference)(g,"40153f24d01cf51e6e896446d274d46439a44fa7a1",null),(0,b.registerServerReference)(h,"70e9e03f0bdc6e37bedcf6c3e98007fde46de58de2",null),a.s(["getCinematicEngagement",()=>h,"getTimelineEntriesByUserId",()=>f,"getTimelineEntryById",()=>g])},12999,a=>{"use strict";var b=a.i(41063),c=a.i(29024),d=a.i(69168),e=a.i(76216);async function f(a,b,f){let g=await (0,c.createClient)(),{data:{user:h}}=await g.auth.getUser();if(!h)return{error:"Unauthorized"};let i="tv"===a?"series":a,j=Number(b);try{"movie"===i?await (0,e.cacheMovie)(j):"series"===i?await (0,e.cacheSeries)(j):"person"===i&&await (0,e.cachePerson)(j)}catch(a){console.error("Error ensuring item details exist:",a)}let k={user_id:h.id,item_type:i};"movie"===i?k.movie_id=j:"series"===i?k.series_id=j:"person"===i?k.person_id=j:"post"===i?k.post_id=String(b):"profile"===i&&(k.target_user_id=String(b));let{data:l,error:m}=await g.from("saved_items").select("id").match(k).maybeSingle();if(m)return{saved:!1};if(l){let{error:a}=await g.from("saved_items").delete().eq("id",l.id);return a?{saved:!0}:((0,d.revalidatePath)(f),{saved:!1})}{let{error:a}=await g.from("saved_items").insert(k).select();return a?(console.error("Insert Error:",a),{saved:!1}):((0,d.revalidatePath)(f),{saved:!0})}}async function g(a,b){let d=await (0,c.createClient)(),{data:{user:e}}=await d.auth.getUser();if(!e)return!1;let f="tv"===a?"series":a,g={user_id:e.id,item_type:f};"movie"===f?g.movie_id=b:"series"===f?g.series_id=b:"person"===f?g.person_id=b:"post"===f?g.post_id=b:"profile"===f&&(g.target_user_id=b);let{data:h}=await d.from("saved_items").select("id").match(g).maybeSingle();return!!h}(0,a.i(72273).ensureServerEntryExports)([f,g]),(0,b.registerServerReference)(f,"7045ac7103bacacfa671710777d476e4ac3284897b",null),(0,b.registerServerReference)(g,"603f5589cc16c0d8cffb188ec6bdad3c732435bda0",null),a.s(["getIsSaved",()=>g,"toggleSaveItem",()=>f])},83697,a=>{"use strict";var b=a.i(76181),c=a.i(58139),d=a.i(76216),e=a.i(38324),f=a.i(12999),g=a.i(90093);a.s([],20679),a.i(20679),a.s(["003e8b396fa0a6461ff46d1f980f0f3e445e689b86",()=>d.getRegionalDiscoverSections,"00683e089f24bf051dde09a3a6d87c7845379672d7",()=>b.getProfileForEdit,"0069116b61067c2a5f8dd123ea37c09c7b43899146",()=>d.getPopularMovies,"007ef9010c76a0a35f1c51b8800bed2350a67fa999",()=>d.getPopularTv,"007f4304d26a5fb9f73eb78d5882ca3b3d3f30d5f2",()=>e.createAdminClient,"00965b16e469e1226fd945267c2682d2c72c20d17c",()=>d.getDiscoverKdramas,"00a5e44efe8453720c80c4486c1d17d72add854a24",()=>c.logout,"00a999dd3a2ed866392a2daecbf6615075f1c00a72",()=>d.getTrendingHero,"00d0567cd8df0fc447dd1e815c2ddf184f0c18128e",()=>b.getUserProfile,"00eb7c54fe2cf91eb54bd5fa902a34910b66c49f4d",()=>d.getDiscoverAnime,"00fdca6daa5e04389180b37535e8274fa77914a78e",()=>d.getTrendingAll,"400bcb2c36f7c47e3731ae06dffd2224b3a2699e1e",()=>b.getFollowRequests,"4014fbfdff9342dd0c42b9ff583a3342422dc0f22a",()=>b.getProfileByUsername,"40153f24d01cf51e6e896446d274d46439a44fa7a1",()=>g.getTimelineEntryById,"401909457587245232eaca27671fff58b3c730d6f1",()=>d.cacheSeries,"401eedccfe768d7030b1d49e8f092b2f44eaa41678",()=>d.getPersonDetails,"401f2c77db66442cf38ce5a83c458e601f1c7b05c7",()=>b.getProfileAndFollowStatus,"402603549cdfd9882438516ae21e193481ebd6860c",()=>d.getMovieDetails,"402c60c195c27d7e4ee6875efa618185b1ac3231fb",()=>b.getFollowers,"403a6fad28aa92529a7090c2ea0a51aada25351958",()=>d.cacheMovie,"4047dd0ce88f4279733a1b257efef3eef9f46b98fe",()=>b.checkProfileCompletion,"405874440a1b09bc8e4b129305e5e968566e7cd436",()=>d.discoverMedia,"405a83a00c08994b5b17f545dc1643993ea0e7347c",()=>g.getTimelineEntriesByUserId,"405e463565a416ddc436c5e3f95a4089cc71100a55",()=>d.searchCinematic,"40a5cd89d9bb290a544cbc62c297de5defda4be1ab",()=>d.getSeriesDetails,"40bf4c0ef6c82b5f8fcdc9b4949d7d08040b4dd7de",()=>b.getFollowing,"40cfbf6bd851b4c3c77831a2af2103b1bc31d65c9f",()=>b.getProfileData,"40cfe719a5adbe13aa2b30a3a28352a6402447f1e9",()=>b.getPodiumData,"40fb56760a01431cb2e97982c2fa791381c0a1f8e2",()=>d.cachePerson,"603f5589cc16c0d8cffb188ec6bdad3c732435bda0",()=>f.getIsSaved,"60c2b24991e2dd0ce0aa7dddb015e6a9b621b2c5e6",()=>b.checkFollowStatus,"60e8b872f629aa0faabbb3ca96b548897d1733ef31",()=>d.fetchTmdbList,"7045ac7103bacacfa671710777d476e4ac3284897b",()=>f.toggleSaveItem,"70e9e03f0bdc6e37bedcf6c3e98007fde46de58de2",()=>g.getCinematicEngagement],83697)},56941,a=>{a.v(a=>Promise.resolve().then(()=>a(29024)))}];

//# sourceMappingURL=_cee49e58._.js.map