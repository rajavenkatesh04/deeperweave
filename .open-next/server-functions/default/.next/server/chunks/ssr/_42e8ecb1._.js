module.exports=[38324,a=>{"use strict";var b=a.i(41063),c=a.i(44995),d=a.i(72273);let e=async()=>(0,c.createClient)("https://jyjynjpznlvezjhnuwhi.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1,autoRefreshToken:!1}});(0,d.ensureServerEntryExports)([e]),(0,b.registerServerReference)(e,"007f4304d26a5fb9f73eb78d5882ca3b3d3f30d5f2",null),a.s(["createAdminClient",0,e])},54641,a=>{"use strict";var b=a.i(29024),c=a.i(38704);let d=(0,c.cache)(async a=>{let c=await (0,b.createClient)(),{data:d,error:e}=await c.from("lists").select(`
            id, title, description, is_public, updated_at,
            list_entries ( rank, movies ( poster_url ), series ( poster_url ) )
        `).eq("user_id",a).order("updated_at",{ascending:!1});return e||!d?[]:d.map(a=>{let b=a.list_entries.map(a=>({poster_url:a.movies?.poster_url||a.series?.poster_url||null})).filter(a=>a.poster_url);return{id:a.id,title:a.title,description:a.description,is_public:a.is_public,item_count:a.list_entries.length,updated_at:a.updated_at,preview_items:b.slice(0,3)}})}),e=(0,c.cache)(async a=>{let c=await (0,b.createClient)(),{data:d,error:e}=await c.from("lists").select(`
            id, title, description, is_public, updated_at,
            list_entries ( rank, movies ( poster_url ), series ( poster_url ) )
        `).eq("user_id",a).eq("is_public",!0).order("updated_at",{ascending:!1});return e||!d?[]:d.map(a=>{let b=a.list_entries.map(a=>({poster_url:a.movies?.poster_url||a.series?.poster_url||null})).filter(a=>a.poster_url);return{id:a.id,title:a.title,description:a.description,is_public:a.is_public,item_count:a.list_entries.length,updated_at:a.updated_at,preview_items:b.slice(0,3)}})}),f=(0,c.cache)(async a=>{let c=await (0,b.createClient)(),{data:d}=await c.from("lists").select("*, profiles (username, display_name, profile_pic_url)").eq("id",a).single();if(!d)return null;let{data:e}=await c.from("list_entries").select("*").eq("list_id",a).order("rank",{ascending:!0});if(!e||0===e.length)return{id:d.id,title:d.title,description:d.description,user_id:d.user_id,updated_at:d.updated_at,creator:d.profiles,entries:[],backdrop_url:null};let f=e.filter(a=>a.movie_id).map(a=>a.movie_id),g=e.filter(a=>a.series_id).map(a=>a.series_id),[h,i]=await Promise.all([f.length>0?c.from("movies").select("tmdb_id, title, poster_url, release_date, backdrop_url").in("tmdb_id",f):{data:[]},g.length>0?c.from("series").select("tmdb_id, title, poster_url, release_date, backdrop_url").in("tmdb_id",g):{data:[]}]),j=new Map(h.data?.map(a=>[a.tmdb_id,a])),k=new Map(i.data?.map(a=>[a.tmdb_id,a])),l=e.map(a=>{let b=null;if(a.movie_id){let c=j.get(a.movie_id);c&&(b={...c,id:c.tmdb_id,type:"movie"})}else if(a.series_id){let c=k.get(a.series_id);c&&(b={...c,id:c.tmdb_id,type:"series"})}return b?{id:a.id,rank:a.rank,note:a.note,media:b}:null}).filter(Boolean);return{id:d.id,title:d.title,description:d.description,user_id:d.user_id,updated_at:d.updated_at,creator:d.profiles,entries:l,backdrop_url:l[0]?.media?.backdrop_url||null}});a.s(["getListDetails",0,f,"getPublicListsByUserId",0,e,"getUserLists",0,d])},72869,a=>{"use strict";var b=a.i(41063),c=a.i(29024),d=a.i(69168);a.i(16162);var e=a.i(25161),f=a.i(76216),g=a.i(76181),h=a.i(54641);async function i(a,b){let d=await (0,c.createClient)(),{data:{user:f}}=await d.auth.getUser();f||(0,e.redirect)("/auth/login");let g=b.get("title"),h=b.get("description");if(!g)return{error:"Title is required"};let{data:i,error:j}=await d.from("lists").insert({user_id:f.id,title:g,description:h,is_public:!0}).select("id").single();if(j)return{error:j.message};(0,e.redirect)(`/lists/${i.id}/edit`)}async function j(a){let b=await (0,c.createClient)(),{data:{user:e}}=await b.auth.getUser();if(!e)return{error:"Unauthorized"};let{error:f}=await b.from("lists").delete().eq("id",a).eq("user_id",e.id);return f?{error:f.message}:((0,d.revalidatePath)("/lists"),{success:!0})}async function k(a,b,e){let g=await (0,c.createClient)(),{data:{user:h}}=await g.auth.getUser();if(!h)return{error:"Unauthorized"};let{data:i}=await g.from("lists").select("user_id").eq("id",a).single();if(!i||i.user_id!==h.id)return{error:"Forbidden"};try{"movie"===b?await (0,f.cacheMovie)(e):await (0,f.cacheSeries)(e)}catch(a){console.error("Cache warm failed",a)}let{data:j}=await g.from("list_entries").select("rank").eq("list_id",a).order("rank",{ascending:!1}).limit(1).single(),k={list_id:a,rank:(j?.rank||0)+1};"movie"===b?k.movie_id=e:k.series_id=e;let{error:l}=await g.from("list_entries").insert(k);return l?{error:l.message}:((0,d.revalidatePath)(`/lists/${a}/edit`),{success:!0})}async function l(a,b){let e=await (0,c.createClient)();await e.from("list_entries").delete().eq("id",a),(0,d.revalidatePath)(`/lists/${b}/edit`)}async function m(a,b){let e=await (0,c.createClient)(),{error:f}=await e.from("list_entries").update({note:b}).eq("id",a);f&&console.error("Note update failed",f),(0,d.revalidatePath)("/lists/[id]/edit"),(0,d.revalidatePath)("/lists/[id]")}async function n(a){let b=await (0,g.getProfileByUsername)(a);return b?await (0,h.getPublicListsByUserId)(b.id):[]}(0,a.i(72273).ensureServerEntryExports)([i,j,k,l,m,n]),(0,b.registerServerReference)(i,"60e95b8f8a111ea685e55785a5bb4459875f0df2bb",null),(0,b.registerServerReference)(j,"40d188958eea10ca09a0e03cc48e4b74e6db186ec0",null),(0,b.registerServerReference)(k,"7064b9f2e7beece998798eca43c9d74fc38e8ec18f",null),(0,b.registerServerReference)(l,"60ebb1b99b2c99a6106e080caa9397933db9ceb14b",null),(0,b.registerServerReference)(m,"60ec0e94bb29456e662dab1f0a371a4f2ab6bb4b82",null),(0,b.registerServerReference)(n,"40647ac1383ebcdd22f03176596892e6c75d90bd7e",null),a.s(["addToList",()=>k,"createList",()=>i,"deleteList",()=>j,"removeFromList",()=>l,"updateListEntryNote",()=>m])},51153,a=>{"use strict";var b=a.i(76181),c=a.i(58139),d=a.i(72869);a.s([],92414),a.i(92414),a.s(["00683e089f24bf051dde09a3a6d87c7845379672d7",()=>b.getProfileForEdit,"00a5e44efe8453720c80c4486c1d17d72add854a24",()=>c.logout,"00d0567cd8df0fc447dd1e815c2ddf184f0c18128e",()=>b.getUserProfile,"400bcb2c36f7c47e3731ae06dffd2224b3a2699e1e",()=>b.getFollowRequests,"4014fbfdff9342dd0c42b9ff583a3342422dc0f22a",()=>b.getProfileByUsername,"401f2c77db66442cf38ce5a83c458e601f1c7b05c7",()=>b.getProfileAndFollowStatus,"402c60c195c27d7e4ee6875efa618185b1ac3231fb",()=>b.getFollowers,"4047dd0ce88f4279733a1b257efef3eef9f46b98fe",()=>b.checkProfileCompletion,"40bf4c0ef6c82b5f8fcdc9b4949d7d08040b4dd7de",()=>b.getFollowing,"40cfbf6bd851b4c3c77831a2af2103b1bc31d65c9f",()=>b.getProfileData,"40cfe719a5adbe13aa2b30a3a28352a6402447f1e9",()=>b.getPodiumData,"60c2b24991e2dd0ce0aa7dddb015e6a9b621b2c5e6",()=>b.checkFollowStatus,"60e95b8f8a111ea685e55785a5bb4459875f0df2bb",()=>d.createList],51153)}];

//# sourceMappingURL=_42e8ecb1._.js.map