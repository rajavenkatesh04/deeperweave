module.exports=[38324,a=>{"use strict";var b=a.i(41063),c=a.i(44995),d=a.i(72273);let e=async()=>(0,c.createClient)("https://jyjynjpznlvezjhnuwhi.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1,autoRefreshToken:!1}});(0,d.ensureServerEntryExports)([e]),(0,b.registerServerReference)(e,"007f4304d26a5fb9f73eb78d5882ca3b3d3f30d5f2",null),a.s(["createAdminClient",0,e])},18644,a=>{"use strict";var b=a.i(41063),c=a.i(59263),d=a.i(29024);a.i(16162);var e=a.i(25161),f=a.i(69168),g=a.i(76216),h=a.i(76181),i=a.i(72273);let j=c.z.object({username:c.z.string().min(3,"Username must be at least 3 characters.").regex(/^[a-z0-9_]+$/,"Username can only contain lowercase letters, numbers, and underscores."),display_name:c.z.string().min(1,"Display name is required."),date_of_birth:c.z.string().refine(a=>{let b=new Date,c=new Date(a),d=b.getFullYear()-c.getFullYear(),e=b.getMonth()-c.getMonth();return(e<0||0===e&&b.getDate()<c.getDate())&&d--,d>=18},{message:"You must be at least 18 years old to join."}),country:c.z.string().min(1,"Please select your country."),gender:c.z.enum(["male","female","non-binary","prefer_not_to_say"],{message:"Please select a gender option."})});async function k(a,b){let c=await (0,d.createClient)(),{data:{user:g}}=await c.auth.getUser();if(!g)return{message:"Authentication error. Please log in again."};let h=j.safeParse(Object.fromEntries(b.entries()));if(!h.success)return{errors:h.error.flatten().fieldErrors,message:"There were errors with your submission. Please review the fields."};let{username:i,display_name:k,date_of_birth:l,country:m,gender:n}=h.data,{data:o}=await c.from("profiles").select("username").eq("username",i).neq("id",g.id).maybeSingle();if(o)return{errors:{username:["This username is already taken."]},message:"Username is unavailable."};let{error:p}=await c.from("profiles").upsert({id:g.id,username:i,display_name:k,date_of_birth:l,country:m,gender:n});if(p)return console.error("Profile update error:",p),{message:"Database error: Could not save profile."};(0,f.revalidatePath)("/profile","layout"),(0,e.redirect)("/profile")}let l=c.z.object({username:c.z.string().min(3,"Username must be at least 3 characters.").regex(/^[a-z0-9_]+$/,"Username can only contain lowercase letters, numbers, and underscores."),display_name:c.z.string().min(1,"Display name is required."),bio:c.z.string().max(160,"Bio cannot be longer than 160 characters.").optional(),sections_json:c.z.string().optional()});async function m(a,b){let c=await (0,d.createClient)(),{data:{user:e}}=await c.auth.getUser();if(!e)return{message:"Authentication error. Please log in again."};let h=l.safeParse(Object.fromEntries(b.entries()));if(!h.success)return{errors:h.error.flatten().fieldErrors,message:"There were errors with your submission."};let{username:i,display_name:j,bio:k,sections_json:m}=h.data,{data:n}=await c.from("profiles").select("username").eq("username",i).neq("id",e.id).maybeSingle();if(n)return{errors:{username:["This username is already taken."]},message:"Username is unavailable."};let o={username:i,display_name:j,bio:k},p=b.get("profile_pic");if(p&&p.size>0)try{let{data:a}=await c.storage.from("profile_pics").list(e.id);if(a&&a.length>0){let b=a.map(a=>`${e.id}/${a.name}`);await c.storage.from("profile_pics").remove(b)}let b=p.name.split(".").pop(),d=Date.now(),f=`${e.id}/profile-${d}.${b}`,{error:g}=await c.storage.from("profile_pics").upload(f,p,{upsert:!0,cacheControl:"3600"});if(g)throw g;let{data:{publicUrl:h}}=c.storage.from("profile_pics").getPublicUrl(f);o.profile_pic_url=h}catch(a){return console.error("Profile Pic Error:",a),{message:"Database error: Could not upload profile picture."}}let{error:q}=await c.from("profiles").update(o).eq("id",e.id);if(q)return console.error("Profile update error:",q),{message:"Database error: Could not update profile details."};if(m)try{let a=JSON.parse(m),b=new Set,d=new Set,f=new Set;a.forEach(a=>{a.items&&Array.isArray(a.items)&&a.items.forEach(a=>{if(!a)return;let c=Number(a.id);"movie"===a.type?b.add(c):"tv"===a.type?d.add(c):"person"===a.type&&f.add(c)})});let h=Array.from(b);if(h.length>0){let{data:a}=await c.from("movies").select("tmdb_id").in("tmdb_id",h),b=new Set(a?.map(a=>a.tmdb_id)||[]),d=h.filter(a=>!b.has(a));d.length>0&&await Promise.all(d.map(a=>(0,g.cacheMovie)(a)))}let i=Array.from(d);if(i.length>0){let{data:a}=await c.from("series").select("tmdb_id").in("tmdb_id",i),b=new Set(a?.map(a=>a.tmdb_id)||[]),d=i.filter(a=>!b.has(a));d.length>0&&await Promise.all(d.map(a=>(0,g.cacheSeries)(a)))}let j=Array.from(f);if(j.length>0){let{data:a}=await c.from("people").select("tmdb_id").in("tmdb_id",j),b=new Set(a?.map(a=>Number(a.tmdb_id))||[]),d=j.filter(a=>!b.has(a));d.length>0&&await Promise.all(d.map(a=>(0,g.cachePerson)(a)))}await c.from("profile_sections").delete().eq("user_id",e.id);for(let b=0;b<a.length;b++){let d=a[b],{data:f,error:g}=await c.from("profile_sections").insert({user_id:e.id,title:d.title,type:d.type,rank:b+1}).select("id").single();if(g||!f)continue;let h=(d.items||[]).map((a,b)=>a?{section_id:f.id,item_type:a.type,movie_id:"movie"===a.type?Number(a.id):null,series_id:"tv"===a.type?Number(a.id):null,person_id:"person"===a.type?Number(a.id):null,rank:b+1}:null).filter(Boolean);h.length>0&&await c.from("section_items").insert(h)}}catch(a){return console.error("Error processing sections:",a),{message:"Saved profile, but failed to update showcase sections."}}return(0,f.revalidatePath)("/profile","layout"),(0,f.revalidatePath)(`/profile/${i}`),{message:"Success"}}async function n(a){let b=await (0,d.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return{available:!1,message:"Not authenticated"};if(!a||a.length<3)return{available:!1,message:"Username too short"};let{data:e,error:f}=await b.from("profiles").select("id").eq("username",a).neq("id",c.id).maybeSingle();return f?{available:!1,message:"Database error"}:e?{available:!1,message:"Username is already taken."}:{available:!0,message:"Username is available!"}}let o=c.z.object({visibility:c.z.enum(["public","private"]),content_preference:c.z.enum(["sfw","all"])});async function p(a,b){let c=await (0,d.createClient)(),{data:{user:g}}=await c.auth.getUser();if(!g)return{message:"Authentication error."};let h=o.safeParse(Object.fromEntries(b.entries()));if(!h.success)return{errors:h.error.flatten().fieldErrors,message:"Invalid data provided."};let{visibility:i,content_preference:j}=h.data,{error:k}=await c.from("profiles").update({visibility:i,content_preference:j}).eq("id",g.id);return k?(console.error("Settings update error:",k),{message:"Database Error: Could not update settings."}):((0,f.revalidatePath)("/profile/settings"),(0,f.revalidatePath)("/profile"),(0,e.redirect)("/profile"),{message:"Your settings have been saved successfully!"})}async function q(a){if(a.length<2)return[];let b=await (0,d.createClient)(),{data:{user:c}}=await b.auth.getUser(),{data:e,error:f}=await b.from("profiles").select(`
            id, 
            username, 
            display_name, 
            profile_pic_url, 
            bio, 
            role,
            visibility
        `).textSearch("fts",a,{type:"websearch",config:"english"}).limit(10);if(f||!e)return console.error("Search error:",f),[];let g=new Map;if(c&&e.length>0){let a=e.map(a=>a.id),{data:d}=await b.from("followers").select("following_id, status").eq("follower_id",c.id).in("following_id",a);d&&d.forEach(a=>{g.set(a.following_id,a.status)})}return e.map(a=>({...a,visibility:a.visibility,follow_status:g.get(a.id)||"not_following"}))}async function r(a){(0,f.unstable_noStore)();let b=await (0,d.createClient)(),{data:c}=await b.from("profiles").select("*, follower_count:followers!following_id(count), following_count:followers!follower_id(count)").eq("username",a).single();if(!c)return{profile:null,followerCount:0,followingCount:0};let e=c.follower_count[0]?.count||0,g=c.following_count[0]?.count||0;return{profile:c,followerCount:e,followingCount:g}}let s=c.z.object({confirmation:c.z.string().refine(a=>"DELETE"===a,{message:'You must type "DELETE" to confirm.'})});async function t(a,b){let c=await (0,d.createClient)(),{data:{user:g}}=await c.auth.getUser();if(!g)return{message:"Authentication error."};let h=s.safeParse(Object.fromEntries(b.entries()));if(!h.success)return{errors:h.error.flatten().fieldErrors,message:"Confirmation is incorrect."};try{let{data:a}=await c.storage.from("profile_pics").list(g.id);if(a&&a.length>0){let b=a.map(a=>`${g.id}/${a.name}`),{error:d}=await c.storage.from("profile_pics").remove(b);d&&console.error("Failed to delete profile pics:",d)}let{data:b}=await c.storage.from("timeline_photos").list(g.id);if(b&&b.length>0){let a=b.map(a=>`${g.id}/${a.name}`);await c.storage.from("timeline_photos").remove(a)}}catch(a){console.error("Error cleaning up storage files:",a)}let{error:i}=await c.rpc("delete_my_account");if(i)return console.error("Account deletion RPC error:",i),{message:"A server error occurred. Could not delete account."};await c.auth.signOut(),(0,f.revalidatePath)("/","layout"),(0,e.redirect)("/delete-success")}async function u(a){let b=await (0,h.getPodiumData)(a);return b&&b.sections?b.sections:[]}(0,i.ensureServerEntryExports)([k,m,n,p,q,r,t,u]),(0,b.registerServerReference)(k,"6098dd31f5c91fea51e8ba3ed960e9643949d4ed86",null),(0,b.registerServerReference)(m,"60826a603a5eb3b50712d45c43376b4589f187388b",null),(0,b.registerServerReference)(n,"4092c60b305f7924ea37b3c4bc9f2b2781f78b9557",null),(0,b.registerServerReference)(p,"6033811cc695c99ac267e43ae44d701bcfe54b5c60",null),(0,b.registerServerReference)(q,"40db3109247e2eda43546539812bc50eb62478030b",null),(0,b.registerServerReference)(r,"40e7b2cc38b97e02723fa1a69b8372d45365f40226",null),(0,b.registerServerReference)(t,"6065cab676e3ca618e984c2e418a52303a977aec2d",null),(0,b.registerServerReference)(u,"40eef552ad3c8496caa0b2bae6f553ad85b09fe36f",null),a.s(["checkUsernameAvailability",()=>n,"completeProfile",()=>k,"deleteMyAccount",()=>t,"getProfileCardData",()=>r,"searchProfiles",()=>q,"updateProfile",()=>m,"updateProfileSettings",()=>p])},83694,a=>{"use strict";var b=a.i(76181),c=a.i(58139),d=a.i(18644),e=a.i(76216);a.s([],95993),a.i(95993),a.s(["00683e089f24bf051dde09a3a6d87c7845379672d7",()=>b.getProfileForEdit,"00a5e44efe8453720c80c4486c1d17d72add854a24",()=>c.logout,"00d0567cd8df0fc447dd1e815c2ddf184f0c18128e",()=>b.getUserProfile,"400bcb2c36f7c47e3731ae06dffd2224b3a2699e1e",()=>b.getFollowRequests,"4014fbfdff9342dd0c42b9ff583a3342422dc0f22a",()=>b.getProfileByUsername,"401f2c77db66442cf38ce5a83c458e601f1c7b05c7",()=>b.getProfileAndFollowStatus,"402c60c195c27d7e4ee6875efa618185b1ac3231fb",()=>b.getFollowers,"4047dd0ce88f4279733a1b257efef3eef9f46b98fe",()=>b.checkProfileCompletion,"405e463565a416ddc436c5e3f95a4089cc71100a55",()=>e.searchCinematic,"4092c60b305f7924ea37b3c4bc9f2b2781f78b9557",()=>d.checkUsernameAvailability,"40bf4c0ef6c82b5f8fcdc9b4949d7d08040b4dd7de",()=>b.getFollowing,"40cfbf6bd851b4c3c77831a2af2103b1bc31d65c9f",()=>b.getProfileData,"40cfe719a5adbe13aa2b30a3a28352a6402447f1e9",()=>b.getPodiumData,"60826a603a5eb3b50712d45c43376b4589f187388b",()=>d.updateProfile,"60c2b24991e2dd0ce0aa7dddb015e6a9b621b2c5e6",()=>b.checkFollowStatus],83694)}];

//# sourceMappingURL=_7c0c61ef._.js.map